# ДЗ - 6
## описание архитектурного решения и схема взаимодействия сервисов (в виде картинки)
В качестве api gateway использовал traefik. Логика работы:
- SignUp обрабатывается в сервисе профилей без аутентификации.
- SignIn марщрутизируется на auth сервис, он отправляет в свою очередь запрос к сервису профилей и если профиль с такими учетными данными есть, то создаёт сессию (генерит jwt токен и логин пользователя и сохраняет в redis) и пишет в куку id сессии.
- Все остальные запросы к сервису профилей проходят аутентификацию (паттерн Forward-Auth), gateway делегирует аутентификацию сервису auth он по куке читает из хранилища сессию и если она есть пишет в header x-auth-token и отправляет обогащенный запрос дальше. Сервис профилей парсит и валидирует токен используя открытый ключ (получает его из сервиса auth из файла /well-known/jwks.json) и проверяют есть ли у данного пользователя (по userId из payload токена) права на выполнение операции.